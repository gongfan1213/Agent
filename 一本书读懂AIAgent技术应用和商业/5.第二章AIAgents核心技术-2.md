### 第2章 AI Agent核心技术
#### 2. 基于LLM的AI Agent的能力
以LLM为代表的新一代自然语言处理技术正在革新人机交互的方式，赋予AI Agent前所未有的语言理解和生成能力。基于LLM的AI Agent拥有一系列特定的能力，能够在语言理解、知识表示、常识推理、多轮交互、个性化服务等方面展现出接近人类的智能水平。这些能力使其在处理和生成语言时表现出色，从而在各种应用场景中提供支持和增值服务。以下是这些AI Agent的核心能力：
- **深度语言理解**：能够捕捉语言的微妙差别，理解语境、双关语、成语及特定行业的术语。
- **高级文本生成**：不仅可以根据给定的上下文生成连贯的文本，还能调整风格和语气以适应不同的交流目的。
- **上下文维持**：在对话中记住先前的话题和用户意图，使得持续交流更自然和有连贯性。
- **智能问答**：快速响应用户查询，提供准确的答案，并能在必要时进行深入的交流。
- **摘要和概括**：能够阅读长篇内容，并生成准确的摘要或重点概括。
- **语言翻译**：可以在不同的语言之间进行快速且准确的翻译。
- **信息检索和整合**：通过网络搜索、数据库查询和其他资源来检索所需信息，并整合这些信息为用户提供全面的答案。
- **写作和内容创作**：协助写作，包括生成创意文案、撰写报告、编写代码或创作诗歌和故事。
- **情绪识别和响应**：侦测用户的情绪倾向，并据此调整回复，以提供更为人性化的交流体验。
- **自我学习和优化**：通过用户交互和额外的训练数据，不断优化模型以提供更好的用户体验。
- **逻辑推理和解决问题**：根据提供的信息，应用推理来解决问题或提供建议。
- **任务规划**：能够根据目标拆解任务，生成执行计划，指导任务完成。
- **策略优化**：在博弈、优化等任务中，能够学习和调整策略，找出最优解。
- **个性化服务**：根据用户的行为和偏好提供个性化的建议和服务。

这些能力结合起来，使得基于LLM的AI Agent成为强大的辅助工具，应用于客户支持、文本分析、内容创作以及其他需要复杂语言处理的领域。根据OpenAI对AI Agent的定义，目前我们所说的AI Agent本质上是一个

#### 3. 基于LLM的AI Agent的属性特征
需要说明的是，AI发展到当前的LLM时代，很多AI工具看起来已经具备了初步的Agent能力。并且，随着LLM快速走向端侧，更多的智能终端硬件和移动软件应用将升级为AI Agent。从自动化角度而言，虽然AI工具（包括机器人和Agent）都是旨在自动化任务的软件程序，但特定的关键特征将AI Agent从AI软件中区分开来。从目前一些产品和项目的表现来看，基于LLM的AI Agent拥有以下特征：
- **感知（Perception）**：可以通过传感器或数据输入来感知其环境或上下文，并据此做出响应，例如自动驾驶汽车使用雷达和摄像头来感知周围环境。
- **推理（Reasoning）**：根据收集到的信息进行决策，这既可能涉及简单的if - else逻辑规则，也可能涉及复杂的机器学习算法。
- **动作（Action）**：采取某种行动以达成其目标，例如，保姆机器人可能会把餐盘放回厨房，自动驾驶汽车可能会调整速度或转向。
- **学习（Learning）**：AI Agent通常具备机器学习的能力，这意味着它们可以通过新的数据不断地优化自身的响应，根据经验改进自己的行为。这种学习过程既可能是显式的，通过训练数据进行，也可能是隐式的，通过用户交互实现。 
- **适应性（Adaptivity）**：能够根据环境的变化和任务的需求动态地调整其行为策略和知识结构。这种适应性使其能够在复杂多变的现实世界中完成任务。
- **交互性（Interactivity）**：能够与环境、人类和其他AI Agent进行信息交互和社会交互。它可以感知外界信息，理解人类的指令和反馈，并据此调整自身的行为和决策，可以与人类或其他AI Agent互动来完成其任务。 
- **自主性（Autonomy）**：不需要人工干预，具有一定的自主决策能力。能够基于自身的感知、知识和目标，独立地做出决策和采取行动，而无须人类直接控制或干预。这也是AI Agent区别于传统软件的重要特征。 
- **目标驱动（Goal - directed）**：AI Agent的行为决策是以实现特定目标为导向的，如完成任务、优化性能、最大化收益等。这些目标可能是预先设定的，也可能是自主学习的。 
- **连续性（Continuity）**：AI Agent能够在一个连续的时空中感知、思考和行动。它的智能行为是一个持续的过程，而不是对单个事件的简单反应。 
- **限定合理性（Bounded Rationality）**：现实的AI Agent受限于计算资源、知识信息、决策时间等因素，其决策和行为往往是在一定约束条件下追求满意解，而非理论上的最优解。 

除了以上特征，在具体的应用场景中，基于LLM的AI Agent还表现出了自然语言理解与生成、上下文感知、个性化、情感智能、推理和决策能力、多任务能力等鲜明特征，如图2 - 4所示。

![image](https://github.com/user-attachments/assets/577a5a9a-68db-4097-a965-2496a10e93c1)


|AI Agent在应用场景中的特征体现|具体内容|
| ---- | ---- |
|自然语言理解（NLU）|理解人类语言的能力|
|自然语言生成（NLG）|创建人类风格自然语言输出的能力|
|上下文感知|识别和记住对话流程中的关键信息，从而在后续的互动中提供更相关和个性化的回答|
|个性化|根据每个用户的行为、语言使用习惯和偏好提供定制化的回复和服务|
|情感智能|也被称为情感计算，即识别和理解用户的情绪状态，并据此进行响应，提供合适的情感反馈|
|推理和决策能力|基于提供的信息进行逻辑推理，并在必要时帮助用户做出决策|
|多任务能力|同时处理或切换不同类型的任务和请求|

#### 4. 基于LLM的AI Agent的应用特色
基于LLM的AI Agent系统在理解、生成、交互及应用方面表现得与众不同，展现出了一些特色，如下：
- **强大的语言理解和生成能力**：得益于在海量语料上的预训练，LLM掌握了丰富的语言知识，能够进行准确的语言理解和流畅的语言生成，在语法、语义、语用等方面接近甚至超越人类水平。
- **广博的知识储备**：LLM从大规模文本数据中学习，积累了涵盖各个领域的海量知识，形成了庞大的知识库。这使基于LLM的AI Agent能够就各种话题进行分析、讨论、问答，展现出通才型的博学和智慧。 
- **出色的少样本学习能力**：基于预训练积累的语言知识，LLM可以通过少量示例快速理解新的任务要求，生成相关的回复或内容。这种少样本学习能力使AI Agent能够灵活适应新的场景和指令，具备广泛的应用潜力。 
- **语境理解和一致性**：LLM能够根据上下文信息理解单词和句子的具体含义，生成连贯一致的多轮对话。AI Agent能够记忆之前的对话内容，根据语境进行合理回应，使交互更加自然、连贯。 
- **逻辑推理与常识运用**：基于对大量文本的学习，LLM掌握了一定的逻辑推理规则和常识知识。AI Agent能够运用这些能力进行推理和判断，回答需要综合分析的问题。 
- **自主与实时响应**：能够通过独立思考、调用工具逐步完成给定目标。具有实时响应的能力，能够快速地对客户的需求和问题做出回应。 
- **自我学习**：具有自我学习的能力，能够通过不断学习和优化，提高自身的性能和效率。 
- **多任务处理**：LLM可以通过提示工程（prompt engineering）等方式适应不同的任务需求，如问答、写作、摘要、翻译、编程等。这种多任务处理能力使AI Agent成为一个全能型的智能助手。 

这些应用特色使得AI Agent在应用中具备了开放域交互、个性化适配、价值观与伦理对齐、创新思维、智能化服务、人机交互、智能决策、数据驱动、场景广泛等优势，如图2 - 5所示。这些优势对于大幅提升组织业务效率和用户体验有着重要的意义，也让基于LLM的AI Agent在智能化水平、交互体验、任务易用性以及更强的适用性和扩展性，开辟了人机交互的新范式。更多的功能、更高的协助企业提高客户满意度和运营效率。 

随着LLM的持续演进，以及与知识表示、多模态感知、持续学习等技术的深度融合，LLM驱动的AI Agent有望在更多领域发挥增强智能的重要作用，成为人类认知智能的得力助手和伙伴。 

当然，LLM的局限性，如计算和存储效率、推理解释能力、知识更新能力等，也成为下一步重点攻关的方向。

|AI Agent的应用优势|具体内容|
| ---- | ---- |
|开放域交互|不同于传统的任务型对话系统，基于LLM的AI Agent能够就开放域的各种话题展开交流，表现出广泛的应对能力和知识储备，使人机交互更加灵活、丰富|
|个性化适配|LLM可以通过持续学习和微调，适应特定用户或场景的交互需求，在语言风格、知识偏好等方面进行个性化定制，提供更加贴心、顺畅的使用体验|
|价值观与伦理对齐|LLM可以通过细粒度的控制和引导，使AI Agent的行为符合人类的价值观和伦理准则，如诚实、善良、公平等。这有助于建立可信赖、负责任的人机交互关系|
|创新思维|LLM掌握的知识和语言模式具有一定的多样性和灵活性，使AI Agent能够在对话中提出创新的观点、思路和解决方案，模拟人类的创造性思维|
|智能化服务|通过自然语言处理、语音识别等技术，为客户提供自动化回复、智能推荐等服务|
|人机交互|需要与客户进行有效的人机交互，以便更好地理解客户的需求和问题。自然语言处理和语音识别等技术可以帮助AI Agent理解和处理客户的语言|
|智能决策|具备智能决策和执行能力，以便更好地为客户提供服务。机器学习和深度学习等技术可以帮助AI Agent学习和理解客户的需求和问题，从而更加智能化地做出决策|
|数据驱动|基于LLM的AI Agent需要大量的数据和算法来训练和优化模型|
|场景广泛|应用场景非常广泛，如智能客服、智能写作、智能翻译、智能推荐等|

![image](https://github.com/user-attachments/assets/be15fe83-5d70-4865-856f-e272a796b6e6)


### 2.2.3 LLM成为AI Agent的全新大脑
还记得在第1章我们提到的AI Agent特征吗？我们提到了它的五个特征。目前业界普遍认为，基于LLM的AI Agent至少具备自主性、反应性、主动性和社交能力四大特征。下面我们分别从这四大特征入手，解释为何LLM能够成为AI Agent的全新大脑。
#### 1. 自主性
自主性（Autonomy）是指一个Agent在没有人类或其他人直接干预的情况下运行，并对其行动和内部状态拥有一定程度的控制。AI Agent不仅应具备按照人类的明确指令完成任务的能力，还应表现出独立发起和执行行动的能力，这意味着一定程度的自主探索和决策。AutoGPT等应用体现了LLM在构建自主Agent方面的巨大潜力，只需向它们提供一项任务和一套可用工具，它们就能自主制订计划并执行计划，以实现最终目标。LLM本身就有很强的自主性，主要表现在：
- 通过生成类似人类的文本参与对话，并在没有详细步骤指示的情况下执行各种任务来展示一种自主性。
- 根据环境输入动态调整输出，体现出一定程度的自适应能力。 
- 通过展示创造力来体现自主性，比如提出新颖的想法、故事或解决方案，而这些并没有明确编入它们的程序。 

LLM本身的自主性能力大幅提升了Agent的自主性表现。

#### 2. 反应性
Agent的反应能力是指它对环境中的即时变化和刺激做出快速反应的能力，也就是说，Agent可以感知周围环境的变化，并迅速采取适当的行动。传统语言模型的感知空间局限于文本输入，行动空间局限于文本输出。现在研究人员已经证明，利用多模态融合技术可以扩展语言模型的感知空间，使其能够快速处理来自环境的视觉和听觉信息。这些进步使LLM能够有效地与真实世界的物理环境互动，并在其中执行任务。

目前基于LLM的AI Agent面临的一个主要挑战是，在执行非文本操作时，需要一个中间步骤，即以文本形式产生想法或制定工具使用方法，然后再将其转化为具体操作。这一中间步骤会消耗时间，降低响应速度。当然，这与人类的行为模式密切相关，毕竟人类的行为模式遵循“先思考后行动”的原则。所以在使用体验上，Agent产品允许一定的响应时间。相比于传统AI技术，LLM还是极大地提升了Agent的反应能力。

#### 3. 主动性
主动是指Agent不仅会对环境做出反应，还能积极主动地采取以目标为导向的行动。这一特征强调，Agent可以在行动中进行推理、制订计划和采取主动措施，以实现特定目标或适应环境变化。

直观上看，LLM中的下一个标记预测范式可能不具备意图或愿望。但研究表明，它们可以隐式地生成这些状态的表征，并指导模型的推理过程。LLM具有很强的概括推理和规划能力。通过向LLM发出类似“让我们一步步地思考”的指令，可以激发其推理能力，如逻辑推理和数学推理。同样，LLM也以目标重拟、任务分解和根据环境变化调整计划等形式显示了规划的新兴能力。这种能力对于提升Agent的主动性有着很大的助力。

#### 4. 社交能力
社交能力是指一个Agent通过某种交流语言与其他Agent（包括人类）进行交互的能力。LLM具有很强的自然语言交互能力，如理解和生成能力等。这种能力使它们能够以可解释的方式与其他模型或人类进行交互，构成了基于LLM的AI Agent的社会能力的基础。

许多研究人员已经证明，基于LLM的AI Agent可以通过协作和竞争等社会行为提高任务绩效（MetaGPT）。通过输入特定的提示，LLM也可以扮演不同的角色，从而模拟现实世界中的社会分工（游戏Overcooked）。此外，将多个具有不同身份的Agent放入一个社会中时，还可以观察到新出现的社会现象（Generative Agent）。由此，基于LLM的AI Agent将能够承载与彰显更多的社交能力。

LLM能够从不同层面赋能并增强Agent，因而更加适合作为AI Agent大脑。并且从当前AI技术形态及未来的技术发展路径而言，LLM将会在很长一段时期内能够胜任这一能力。

### 2.2.4 为什么需要基于LLM的AI Agent
复旦大学NLP团队发表的论文“The Rise and Potential of Large Language Model Based Agents: A Survey”认为，从NLP到AGI的发展路线分为五级：语料库、互联网、感知、具身和社会属性。图2 - 6展示了从NLP到AGI的发展路线。

目前LLM已经达到第二级，具有互联网规模的文本输入和输出。在第二级的基础上，如果赋予基于LLM的AI Agent感知空间和行动空间，它们将达到第三、第四级。再进一步地，多个Agent通过互动、合作解决更复杂的任务，或者反映出现实世界的社会行为，则有潜力来到第五级。

随着ChatGPT提供的插件和函数调用功能的出现，人们对LLM作为智能中枢架构的思考被激发出来。当微软和Google基于LLM发布了Copilot架构的应用程序时，人们开始思考LLM是如何与外部复杂系统进行交互的。

在GitHub上，已经有一些项目（如LangChain）实现了类似的能力，也已经有了具有一定封装的工具AutoGPT和BabyAGI。

从LLM与LangChain等工具的结合来看，Agent释放了内容生成、编码和分析方面的多种可能性。LangChain是一个功能强大的LLM编程框架，旨在为开发人员提供全面的工具和组件，以简化基于LLM的应用程序的开发过程。它不仅提供了各种必要的组件，还通过链（LangChain中Chain的由来）的概念，为常规的应用流程提供了标准化的解决方案。基于LangChain开发的LLM应用非常好地诠释了Agent的各种特性。另外，ChatGPT的各种插件也能体现这一点，其中比较有代表性的插件是Code Interpreter。

![image](https://github.com/user-attachments/assets/a1af6509-0517-446b-b4dc-7d18b2c3c7fe)


|从NLP到AGI的发展路线|简介|特点|
| ---- | ---- | ---- |
|第一级：语料库|早期NLP的基石<br>收集和整理大量的文本数据，为后续的NLP任务提供基础| - |
|第二级：互联网|LLM的发展阶段<br>具有互联网规模的文本输入和输出，利用互联网数据进行模型训练|依靠互联网数据训练的语言模型具备更强的文本生成和理解能力<br>为第三级的感知智能打下基础|
|第三级：感知|利用基于LLM的AI Agent实现感知智能<br>人工智能能够理解和解析复杂的信息，具备一定的视觉和语音感知能力|依赖LLM技术<br>结合多模态数据（文本、图像、语音等）进行感知和行动|
|第四级：具身|人工智能具备更高层级的身体模拟和环境交互能力<br>结合物理世界的信息，实现更真实的交互和决策|在感知智能的基础上，进一步融入物理世界的感知信息<br>通过与环境的实时交互，优化决策和行为|
|第五级：社会属性|实现Agent社会的潜力阶段<br>人工智能具备社会属性，能够与其他Agent互动与协作|多个Agent之间进行协同和竞争，实现更复杂的社会行为<br>通过社会属性的引入，人工智能能够更好地适应和融入人类社会|

在这方面的应用上，Agent的概念发挥着举足轻重的作用。我们可将LLM视作Agent的大脑，将Agent视为人工智能的大脑，它们都使用LLM进行推理、计划和采取行动。虽然LLM在其训练知识范围内表现优秀，但其知识仅限于

训练数据，并且这些知识很快就会过时。此外，LLM还存在一些缺点，如下：
- **产生幻觉**：模型有时会提供不真实或错误的信息。
- **结果不真实**：模型的结果并不总是基于事实或可靠的信息。 
- **对时事了解有限**：模型可能无法提供最新的信息或对当前事件的看法。 
- **难以应对复杂计算**：LLM在处理数学计算、逻辑推理等方面的问题时可能存在困难。 

在这种情况下，AI Agent可以发挥其作用。通过利用外部工具，AI Agent能够克服这些限制。这些工具可以是各种插件、集成API、代码库等，例如：
- **Google搜索**：获取最新信息。 
- **Python REPL**：执行代码。 
- **Wolfram**：进行复杂的计算。 
- **外部API**：获取特定信息。 

而LangChain提供了一个通用的框架，通过LLM的指令可以轻松实现这些工具的调用。可以说，AI Agent的诞生是为了让人们使用LLM去处理各种复杂任务，或者说是发挥出LLM的最佳性能。在这方面，目前厂商们通过各种架构与方法所构建的行动类Agent和规划执行类Agent，已经能够处理十分复杂的任务。

### 2.2.5 AI Agent如何工作

AI Agent通过感知环境、处理信息并采取行动来实现特定目标或任务。该工作流程通常包括以下步骤：

1. **感知环境**：自主Agent首先需要收集有关其环境的信息，可以使用传感器或从各种来源收集数据来做到这一点。

2. **处理输入数据**：AI Agent获取在第1步中收集的知识并准备进行处理，包括组织数据、创建知识库或制作AI Agent可以理解和使用的内部表示形式。 

3. **决策**：AI Agent使用逻辑或统计分析等推理技术，根据其知识库和目标做出明智的决策，其中可能涉及应用预先确定的规则或机器学习算法。 

4. **规划和执行操作**：AI Agent制订计划或一系列步骤来实现其目标。这可能涉及制定分步策略、优化资源分配或考虑各种限制和优先级。根据其计划，Agent执行所有步骤以实现预期目标。它还可以接收来自环境的反馈或新信息，这些信息可用于调整其未来的操作或更新其知识库。 

5. **学习和改进**：采取行动后，AI Agent可以从自己的经验中学习。此反馈循环允许Agent提高性能并适应新的情况和环境。 


整个过程，简单概括就是，AI Agent通过收集和分析数据对其进行预处理，根据机器学习算法做出决策，采取行动并接收反馈。

为了帮助理解，我们再看构建于GPT - 4上的AI Agent的工作流程，如图2 - 7所示。

|构建于GPT - 4上的AI Agent的工作流程|具体内容|
| ---- | ---- |
|1. 提供目标和任务| - |
|2. 完成任务|由执行Agent（GPT - 4）执行|
|3. 发送任务结果|执行Agent（GPT - 4）将任务结果发送给任务创建Agent（GPT - 4）|
|4. 添加新任务|任务创建Agent（GPT - 4）添加新任务|
|5. 设置任务的优先级|任务优先级Agent（GPT - 4）设置任务优先级|
|6. 清理过的任务列表|任务优先级Agent（GPT - 4）输出清理过的任务列表|
|内存|存储任务/结果对，查询记忆以获取上下文|
|上下文|用于执行Agent（GPT - 4）和任务创建Agent（GPT - 4）|

![image](https://github.com/user-attachments/assets/526af7be-b5fe-405d-90df-1a35fb5b9e75)


### 2.3 AI Agent的架构和组成
随着LLM技术的不断成熟，AI Agent的架构和组成也变得越来越复杂和多样化。一个功能完善、性能卓越的AI Agent系统需要协调多个模块和组件的工作，构建合理的架构和流程，才能真正实现智能行为和人机交互。

这一节将从AI Agent的结构、主流架构和主要模块三个方面对AI Agent的架构和组成进行阐述，以期为AI Agent的研究和应用提供参考与指导。



#### 2.3.1 AI Agent的结构
AI Agent是一种软件程序或者硬件设备，旨在与其环境交互，感知其接收的 
