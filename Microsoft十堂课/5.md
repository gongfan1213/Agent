# Lesson 5 What is agentic RAG?
what is identic rag how is it different to basic rag and how can we use it in our applications we're going to answer these questions in this fifth lesson of the AI agents for beginners course in this course we're going to take you from concept to code covering the fundamentals of building AI agents and in this short video follows along with the written lesson including translations and code temples that you can find along the link above and below this video so let's get started looking at what a gentigra is and we'll start looking at basic rag first so rag or retrieval augmented generation enables LLMs to take a query made from a user and retrieve relevant information from a database that information is then added to the context given to the LLM to provide more relevant responses outside of just the trading data of the LLM and while that framework isn't going away a Gentigra adds a new level of capability to it to start on the query side the agent performs an analysis of the query to create a plan of smaller tasks to use the data sources and tools it will need to answer that query and because while there is no such thing as a bad question there are complex questions that require multiple steps and systems to answer and after that information is retrieved from those systems the agent can verify if the information is enough to answer that query if not it can repeat this process of tool calling until it does and what is really great about this is that the agent can maintain long-term memory of this process so it can recall the previous attempts it tried to answer the query and improve the next time without taking those steps and this is why I would have called it adaptive rag but no one asked me when we were named these things so aentic rag it is that's enough talking let's head over to the code and see how to build this now we're here at our code editor to look at the agentic rag sample i am using the semantic kernel Azure search example uh because both we can now create an index using Azure AI search which we'll show you in the setup lesson uh how to actually set up to get the right credentials and again this code is located at the GitHub repo at the top and the bottom of this video so you can work with yourself on your machine so the first thing I want to point to is this class prompt plugin that we've created basically this allows us to after the prompt or the request from the user is sent we can actually augment the prompt so that it gives a lot more direction to the agent in terms of being able to retrieve information so we basically allowing this augmented prompt to come in uh and it basically essentially like rag where we will take the retrieve context so whatever we retrieve from our Azure search database or index and then we're going to take the user query and we're going to direct the agent to first review the retrieve context and see if it answers that query if it doesn't we're also going to direct it to say try any of the available plug-in functions because that's again the power of aentic rag it's not only to do the retrieval part but to combine those elements to other tools and things to get information to answer the query of the user so after that we will make a plugin just so that the the agent has another option in this case we have this class uh weather info plugin and this basically just returns a few different locations and an average temperature so in a in an ideal world that when the user is asking about temperature we don't actually have that information in the Azure search because again maybe that changes quite often but we also have a plugin or another tool that retrieves that information and when a user is making that query we should be able to combine those things um so now we will also add these documents so uh into our Azure search index so we have these travel documents uh we're going to use our credentials that we we set up in the setup chapter and then we basically have just some three or sorry five documents here um it has just some basic information around insurance the destinations that are available um and even you know kind of the benefits of those destinations now we're going to go actually look at the interaction from the user and the agent and I' I've kind of set this up so that we can kind of see how different parts of the application are handling different things in terms of the agentic rag so in this example the user is asking around explaining a Kontoso's travel insurance coverage and the context that it retrieves is a few different documents so we've given it directions to pull in the top three uh in this case you can see that you know obviously the first one is really relevant here in terms of really answering the question around travel insurance but the other ones might be able to support it so you can always see the context that the agents operating by using this drop down and then you can see the response that they the agent gives out in this case this is asking about what the average temperature of the Maldes is so it does a few different things first it retrieves that this is a destination available or offered by Kontoso but as you can see here it since the first review or the retrieve context doesn't answer that question we can actually go back or look at this function calls and it's actually going to make this function call which is the get destinations uh so again this is the destination it's calling with Maldes and it's going to get back the average temperature of the Maldes um I'm not sure exactly this is correct uh average temperature from all these but again this is just to show you uh the ability to first look at the context and see what available tools that it needs to be called and then the last kind of context or last example is when we need to handle both retrieving from rag perspective and the function call because like I said one of the things is that with the gentic rag is that we can handle more complex type of queries than just you know the basic rag so in this case they're asking for a good cold destination offered by Kontoso and what is the average temperature so there's two things kind of steps the agent needs to take right first to see what destinations Kontoso offers and then also the average temperature of that so if you look at this example first it's that the rag context it retrieves a document that says the popular popular destinations so Maldes Twis apps Swiss Alps and African safaris and then it also makes that function call to belt the Swiss Alps to see that this is a cold destination and it gives out the nice response which is a good cold destination offered by Kontoso is the Swiss Alps with the average so we've done both a rag context as well as a function call so that was that again you can run this code on your your side play with the questions maybe add some more documents really experiment and seeing how the powers of a rag but I'll see you in the next [Music]
### 翻译
#### 第5课：什么是代理检索增强生成（agentic RAG）？
什么是代理检索增强生成（agentic RAG）？它与基本的检索增强生成（RAG）有何不同？我们如何在应用程序中使用它呢？我们将在人工智能代理初学者课程的第五课中回答这些问题。在这门课程中，我们会带你从概念到代码，涵盖构建人工智能代理的基础知识。这个短视频是配合书面课程的，包括翻译以及你可以在本视频上方和下方的链接中找到的代码示例。那么，让我们开始了解什么是代理检索增强生成（agentic RAG），我们先来看一下基本的检索增强生成（RAG）。检索增强生成（RAG）使大型语言模型（LLMs）能够接收用户提出的查询，并从数据库中检索相关信息。然后，这些信息会被添加到提供给大型语言模型的上下文中，以便除了仅基于大型语言模型的训练数据之外，还能提供更相关的回复。虽然这个框架不会消失，但代理检索增强生成（agentic RAG）为它增添了新的能力水平。从查询方面开始，代理会对查询进行分析，以创建由较小任务组成的计划，从而使用回答该查询所需的数据源和工具。因为虽然没有所谓的 “坏问题”，但存在一些复杂的问题，需要多个步骤和系统来回答。在从这些系统中检索到信息后，代理可以验证这些信息是否足以回答该查询，如果不够，它可以重复这个工具调用过程，直到能够回答为止。真正很棒的是，代理可以保留这个过程的长期记忆，这样它就可以回忆起之前尝试回答查询的过程，并在下次无需重复这些步骤的情况下进行改进。这就是为什么我想把它称为自适应检索增强生成（adaptive RAG），但在给这些东西命名的时候没人问过我的意见，所以就叫代理检索增强生成（agentic RAG）吧。说得够多了，让我们进入代码部分，看看如何构建它。

现在我们在代码编辑器中查看代理检索增强生成（agentic RAG）的示例，我使用的是语义内核（Semantic Kernel）和Azure搜索的示例。因为我们现在可以使用Azure AI搜索创建一个索引，我们会在设置课程中向你展示如何实际设置以获取正确的凭据。同样，这段代码位于本视频上方和下方的GitHub存储库中，所以你可以在自己的机器上运行。我首先想指出的是我们创建的这个类 “提示插件（prompt plugin）”。基本上，在用户发送提示或请求之后，这个插件允许我们对提示进行扩充，以便在检索信息方面为代理提供更多的指导方向。所以我们基本上允许这个扩充后的提示进入，这本质上就像检索增强生成（RAG）一样，我们将获取检索到的上下文，也就是从我们的Azure搜索数据库或索引中检索到的任何内容，然后我们将获取用户查询，并指导代理首先查看检索到的上下文，看看它是否能回答该查询。如果不能，我们还会指导它尝试任何可用的插件函数，因为这再次体现了代理检索增强生成（agentic RAG）的强大之处，它不仅要进行检索部分，还要将这些元素与其他工具等相结合，以获取信息来回答用户的查询。

在那之后，我们将创建一个插件，以便代理有另一个选项。在这种情况下，我们有这个类 “天气信息插件（weather info plugin）”，它基本上只是返回几个不同的地点和平均温度。在理想情况下，当用户询问温度时，我们在Azure搜索中实际上没有该信息，因为温度可能变化非常频繁。但我们也有一个插件或另一个工具来检索该信息，当用户提出该查询时，我们应该能够将这些东西结合起来。

所以现在我们还将把这些文档添加到我们的Azure搜索索引中。我们有这些旅行文档，我们将使用我们在设置章节中设置的凭据，然后我们基本上这里有三个（抱歉，是五个）文档。这些文档包含一些关于保险、可用目的地甚至这些目的地的好处的基本信息。

现在我们要实际查看用户和代理之间的交互，我已经设置好了，以便我们能够看到应用程序的不同部分在代理检索增强生成（agentic RAG）方面是如何处理不同事情的。在这个例子中，用户询问关于解释康托索（Kontoso）的旅行保险覆盖范围，它检索到的上下文是几个不同的文档。我们已经指示它提取前三个文档。在这种情况下，你可以看到，显然第一个文档在真正回答关于旅行保险的问题方面非常相关，但其他文档可能也能提供支持。所以你可以通过这个下拉菜单随时查看代理操作所依据的上下文，然后你可以看到代理给出的回复。

在这个例子中，用户询问马尔代夫的平均温度是多少。它做了几件不同的事情。首先，它检索到马尔代夫是康托索提供的一个可用目的地。但正如你在这里看到的，由于第一次查看或检索到的上下文没有回答这个问题，我们实际上可以返回或查看这个函数调用，它实际上会进行这个 “获取目的地（get destinations）” 的函数调用。所以再次强调，它用马尔代夫调用这个目的地函数，然后它将得到马尔代夫的平均温度。我不确定这个平均温度是否完全正确，但这只是为了向你展示首先查看上下文并确定需要调用哪些可用工具的能力。

最后一个上下文或最后一个示例是当我们需要从检索增强生成（RAG）的角度和函数调用两方面进行处理时，因为就像我说的，代理检索增强生成（agentic RAG）的一个特点是，与基本的检索增强生成（RAG）相比，它能够处理更复杂类型的查询。在这种情况下，用户询问康托索提供的一个好的寒冷目的地是什么以及平均温度是多少。所以代理需要采取两个步骤，首先查看康托索提供哪些目的地，然后还要查看该目的地的平均温度。

所以如果你看这个例子，首先它的检索增强生成（RAG）上下文检索到一个文档，该文档说受欢迎的目的地有马尔代夫、瑞士阿尔卑斯山和非洲野生动物园。然后它还进行那个函数调用以确定瑞士阿尔卑斯山是一个寒冷的目的地，并且它给出了很好的回复，即康托索提供的一个好的寒冷目的地是瑞士阿尔卑斯山，并给出了平均温度。

所以我们既进行了检索增强生成（RAG）的上下文检索，也进行了函数调用。同样，你可以在自己那边运行这段代码，尝试提出不同的问题，也许添加一些更多的文档，真正地进行实验，看看检索增强生成（RAG）的强大之处。下节课见。

### 要点总结
1. **课程概述**：这是人工智能代理初学者课程的第五课，介绍构建人工智能代理的基础知识，视频有配套书面课程、翻译和代码示例。
2. **基本检索增强生成（RAG）的概念**：使LLMs能接收用户查询，从数据库检索相关信息并添加到上下文中，提供比仅基于训练数据更相关的回复。
3. **代理检索增强生成（agentic RAG）的特点**：
    - 代理分析查询并创建由小任务组成的计划，使用所需数据源和工具。
    - 检索信息后验证是否足以回答查询，不足则重复工具调用过程。
    - 代理可保留过程的长期记忆，改进后续回答，无需重复步骤。
4. **代码示例**：
    - 使用语义内核和Azure搜索示例，可通过Azure AI搜索创建索引，代码在GitHub存储库。
    - **提示插件**：扩充用户提示，指导代理检索信息，结合检索上下文和用户查询，若未解答则尝试可用插件函数。
    - **天气信息插件**：返回地点和平均温度，与Azure搜索结合处理温度查询。
    - **用户与代理交互示例**：
        - 查询旅行保险覆盖范围，检索相关文档并回复。
        - 询问马尔代夫平均温度，先检索目的地信息，未解答则调用 “获取目的地” 函数获取温度。
        - 询问康托索提供的寒冷目的地及平均温度，结合RAG上下文检索和函数调用，确定瑞士阿尔卑斯山并给出平均温度。 
